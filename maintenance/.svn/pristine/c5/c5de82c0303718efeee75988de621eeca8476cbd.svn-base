(
 function (window) {
    var self = this;
    
    var _dueDate = new Date(); // by default in the case of an error redirect immediately to website
    var _currentTimeInternal = 1000;
    var _moduleLoadDate = undefined;
    var _intervalHandler = undefined;
    
    var _predefinedBackColor_1 = '#77A240';
    var _predefinedForeColor_1 = '#DCDCDC';
    
    var _predefinedBackColor_2 = '#59738F';
    var _predefinedForeColor_2 = '#DCDCDC';
    
    var _predefinedBackColor_3 = '#F49101';
    var _predefinedForeColor_3 = '#525455';
    
    function makeMinorAdjustementsIfRunningOnMobileInternal() {
        if(activeBrowser.browserUtility.isMobile) {
         $(".breakLineOnMobileDevices").prop("innerHTML", "<br />");
         $(".frame").css("top", "5.7em");
        }
        $(".frame").css("visibility", "visible");
    }
    
    function setTimeForMaintenanceInternal(timeForMaintenance) {
        _dueDate = new Date(timeForMaintenance);
    }
    
    function cancelRedirectionToMaintenacePageInternal() {
        $("body").load('../redirector/website_redirector.php');  
    }
    
    function calculateMaintenanceTimeInternal() {
        var currentTime = new Date();
        var indexOfSecondInTheRangeFromOneToTen = currentTime.getSeconds().toString();
        var timeToPerformWork = _dueDate - currentTime;
        
        if(timeToPerformWork > 0) {
            var time = new Date(timeToPerformWork);
        
            var minutes = time.getMinutes().toString();
            if(minutes.length < 2) 
              minutes = "0" + minutes;
            var seconds = time.getSeconds().toString();
            if(seconds.length < 2)
              seconds = "0" + seconds;            
            var countdown = "00" + ":" + minutes + ":" + seconds;
        
            document.getElementById("maintenanceTime").innerHTML = countdown;
            document.getElementById("interval").innerHTML = "&nbsp;sekund";
            
            if(indexOfSecondInTheRangeFromOneToTen >= 40 && indexOfSecondInTheRangeFromOneToTen <= 60) {
                $("body").css("background-color", _predefinedBackColor_1);
                $(".frame").css("color", _predefinedForeColor_1);
            }
            else if(indexOfSecondInTheRangeFromOneToTen >= 20 && indexOfSecondInTheRangeFromOneToTen <= 40) {
                $("body").css("background-color", _predefinedBackColor_2);
                $(".frame").css("color", _predefinedForeColor_2);
            }       
            else if(indexOfSecondInTheRangeFromOneToTen <= 20) {
                $("body").css("background-color", _predefinedBackColor_3);
                $(".frame").css("color", _predefinedForeColor_3);
            }
        }
        else {
            cancelRedirectionToMaintenacePageInternal();            
            clearInterval(_intervalHandler);
            var host = window.location.host;
            window.location.href = "http://" + host.substring(host.indexOf(".") + 1);
        }
     }
    
    //public api
     self.calculateMaintenanceTime = function (dueTime) {
         makeMinorAdjustementsIfRunningOnMobileInternal();
         setTimeForMaintenanceInternal(dueTime);
         calculateMaintenanceTimeInternal();
        _intervalHandler = setInterval(calculateMaintenanceTimeInternal, _currentTimeInternal);
     };
    
    window.maintenance = window.maintenance || self;
 }
)(window)